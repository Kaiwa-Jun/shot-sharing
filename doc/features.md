# 機能仕様

## 1. MVPフェーズ

### 基本機能

- 共通RAG（開発者用ナレッジ）での検索機能
- テキスト検索（自然言語での質問）
- 画像検索（クエリ画像のアップロード）
- 推奨設定の3プリセット提示（そのまま/手ブレ優先/ノイズ低減）
- ユーザー投稿機能（投稿と同時にRAGストアに自動登録）
- SEO対策（メタタグ、OGP、sitemap）

### 基本レイアウト（スマホファースト）

**ヘッダー**

- **構成**: アプリアイコン（左）＋ 投稿ボタン📷+（中央）＋ログインユーザーアイコン（右）
- **動作**: 下スクロール時に隠れ、上スクロール時に再表示
- **高さ**: 約56px

**メイン領域**

- **初期表示**: ギャラリー（Masonryレイアウト）
- **パディング**: ヘッダー高さ分の上部余白

**検索入力UI**

- **初期状態**: 右下にフローティングアクションボタン（FAB）として配置
- **FAB位置**: 右下から16pxマージン
- **展開アニメーション**:
  - FAB押下でボタンが入力欄へ変形するトランジション（約300-400ms）
  - アニメーションの流れ：
    1. FAB（円形）が横方向に拡張開始
    2. 同時に上方向へ移動しながら形状変化
    3. 円形から角丸長方形へモーフィング
    4. 🔍アイコンがフェードアウト、入力要素がフェードイン
    5. 質問例バッジが上からスライドイン
  - 背景にオーバーレイ（半透明）をフェードイン

- **展開後の構成**:
  - 質問例バッジを表示（タップで入力欄に自動入力）
  - 入力欄の構成（左から）:
    1. テキスト入力フィールド
    2. 📎 画像添付アイコン
    3. 🎤 マイクアイコン（グレーアウト・MVP以降）
    4. ➤ 送信アイコン

**質問例バッジ**

- 入力欄の上部に配置
- 横スクロール可能なチップ/バッジ形式
- タップで入力欄に自動入力
- 例：
  - 🌅 夕焼けを綺麗に撮るには？
  - 🌙 夜景で手ブレしない設定
  - 👥 室内でポートレート
  - 🏃 動く子供を撮影する設定
  - 🌸 花のマクロ撮影
  - ⛅ 曇りの日の風景
- カテゴリ：シーン別、被写体別、課題別、条件別から選定

### 画面遷移フロー

```
/ (ギャラリー初期画面)
├── FAB押下 → 入力欄展開
│   ├── テキスト入力 → 送信 → /search?q={query}
│   └── 画像添付 → 送信 → /search?mode=image&ref={id}
├── カード選択 → /posts/{id} (モーダル表示)
└── ユーザーアイコン → /me
```

### 各画面の詳細

#### 1. ギャラリー画面（/）

- Masonryグリッド（2列）
- 各カードに表示:
  - サムネイル画像
  - ISO/F値/SS（画像下部にオーバーレイ）
- 無限スクロール実装

#### 2. 検索結果画面（/search）

_レイヤー構造：_

- **背面レイヤー**: 検索結果のギャラリー（常に存在）
- **前面レイヤー**: チャット領域（スライドで表示/非表示）
- **最前面**: 入力欄（常に固定）

_通常表示時（検索後）:_

- ヘッダーに検索ヒット数とフィルタチップ
- ギャラリー形式で検索結果を表示（Masonryレイアウト）
- 画面下部にチャット領域（最新の回答1件を表示）
- 最下部に入力欄を常時表示（FABなし）

_入力欄アクティブ時:_

- 入力欄タップでチャット領域が下から上へスライドアップ（約250-300ms）
- チャット履歴が検索結果を覆い隠す
- 質問例バッジが表示
- スマホキーボードが出現

_アクティブ解除時:_

- チャット領域外タップでチャット領域が上から下へスライドダウン
- 背面の検索結果が再表示
- キーボードが隠れる

#### 3. 作例詳細（/posts/{id}）

_表示トリガー:_

- ギャラリーまたは検索結果の画像カードをタップ

_トランジションアニメーション:_

- Shared Element Transition（タップした画像が元の位置から拡大）
- 約300-400msでスムーズに変形
- 背景のギャラリー/検索結果が薄暗く（opacity: 0.3）

_画面構成:_

- 大きな画像表示（ピンチで拡大可能）
- 下にスクロール可能なコンテンツエリア
  - 撮影設定（1行表示）: 📸 ISO200 • f/2.8 • 1/250s • +0.7EV
  - 類似の作例（横スクロール）
  - アクションボタン: 💾（保存）、✕（閉じる）

_類似作例の動作:_

- 類似作例をタップで横スライドトランジション
- 画像と撮影設定がクロスフェードで切り替え
- 類似作例リストも新しい画像に関連するものに更新
- ブラウザバックで前の作例に戻る

_閉じる動作:_

- 画像を下にスワイプ または 背景タップ
- 逆再生アニメーションで元のカード位置に戻る

#### 4. プロフィール（/me）

- タブ切り替えUI（投稿/保存）
- 各タブ内はMasonryグリッド

#### 5. 投稿画面（/posts/new）

_アクセス方法:_

- ヘッダーの📷+ボタンから遷移

_画面構成:_

```
[キャンセル]    投稿    [公開]

[選択した画像表示]

📸 撮影設定（自動取得）
ISO200 • f/2.8 • 1/250s

📝 ひとこと（任意）
[撮影時の状況や工夫を共有...]
```

_機能:_

- Exif情報の自動読み取り（ない場合は「-」表示）
- 画像から撮影設定を自動表示
- 説明文は任意（プレースホルダーでヒント表示）
- タグ付け不要（RAGが画像内容を自動解析）
- **投稿と同時にRAGストアに自動登録（即座に検索対象化）**
- 投稿完了後はギャラリー（/）にリダイレクト

#### 6. 設定画面（/settings）- 最小限版

- ログアウト
- 利用規約
  - 投稿された画像は全ユーザーの検索対象となる旨
  - 著作権侵害・不適切コンテンツの禁止
  - 人物撮影時の被写体許可の必要性
  - 撮影設定は参考情報である旨の免責事項
- プライバシーポリシー

## 2. MVP以降フェーズ

### 追加機能（優先度順）

**High Priority**

- 音声入力（マイクボタンをChatGPT風UIで配置）
- プロフィールの充実（プロフィール編集機能）
- 履歴画面（/history）- 検索履歴の管理

**Medium Priority**

- 設定画面の拡張（言語設定、単位設定）
- 他ユーザープロフィール（/u/:id）
- 通報機能（作例詳細画面に「問題を報告」ボタン）

**Low Priority**

- 精度向上ループ（Good/Bad収集→再ランキング/メタ更新→Few-shot）
- 高度フィルタ（場所/時間帯/色温度/焦点距離帯）
