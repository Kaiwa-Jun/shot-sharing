# Claude Code プロジェクトガイドライン

このドキュメントは、Shot Sharingプロジェクトで Claude Code を効果的に活用するためのガイドラインです。

## プロジェクト概要

- **プロジェクト名**: Shot Sharing
- **技術スタック**: Next.js 16 (App Router), TypeScript, Tailwind CSS, shadcn/ui, Framer Motion
- **バックエンド**: Vercel, Supabase (PostgreSQL, Auth, Storage)
- **AI/RAG**: Gemini API (File Search API)

## 開発ワークフロー

### 推奨フロー: 探索 → 計画 → コード → コミット

1. **探索フェーズ**: 関連ファイルを読み込み、既存コードを理解する
2. **計画フェーズ**: 実装前に「think」キーワードで計画を立てる（think < think hard < think harder < ultrathink）
3. **実装フェーズ**: 計画に基づいてコードを実装する
4. **コミットフェーズ**: `/deploy` コマンドでコミット・プッシュ・PR作成を実行

⚠️ **重要**: 探索と計画のフェーズをスキップしないこと。すぐにコーディングに入ると、不適切な実装につながる可能性があります。

### テスト駆動開発

1. 期待する入出力ペアに基づいてテストを記述
2. テストが失敗することを確認
3. テストスイートをコミット
4. テストをパスするコードを実装（反復が必要な場合あり）
5. 動作するコードをコミット

## コーディング規約

### TypeScript

- **厳格な型付け**: `any` の使用を避け、適切な型を定義する
- **インターフェース**: データ構造は `interface` または `type` で明示的に定義
- **非同期処理**: async/await を使用し、Promise の適切なエラーハンドリングを行う

### Next.js App Router

- **サーバーコンポーネント**: デフォルトでサーバーコンポーネントを使用
- **クライアントコンポーネント**: 'use client' ディレクティブは必要な場合のみ使用
- **ファイル構成**: App Router の規約に従う（page.tsx, layout.tsx, loading.tsx など）

### React コンポーネント

- **関数コンポーネント**: 常に関数コンポーネントを使用
- **Props の型定義**: すべての Props に型を定義
- **コンポーネント分割**: 単一責任の原則に従い、適切にコンポーネントを分割
- **useEffect の使用禁止**: 可能な限り useEffect を使用しない
  - ❌ データフェッチング → サーバーコンポーネントまたは SWR/React Query を使用
  - ❌ 状態の同期 → 派生状態（derived state）を使用
  - ❌ イベントハンドラー → イベントハンドラー関数内で直接処理
  - ✅ 許容される使用例: DOM操作、外部ライブラリの初期化、ブラウザAPIの使用など、真に副作用が必要な場合のみ

### スタイリング

- **Tailwind CSS**: ユーティリティクラスを使用
- **shadcn/ui**: UI コンポーネントは shadcn/ui を優先的に使用
- **カスタムスタイル**: 必要に応じて CSS Modules または Tailwind の @apply を使用

### アニメーション

- **Framer Motion**: アニメーションには Framer Motion を使用
- **パフォーマンス**: アニメーションは適度に使用し、パフォーマンスを考慮

## Git & GitHub ワークフロー

### ブランチ戦略

- **main**: 本番環境のコード
- **feature/\***: 新機能開発（例: `feature/issue2`）
- **fix/\***: バグ修正
- **docs/\***: ドキュメント更新

### コミットメッセージ

- **日本語**: コミットメッセージは日本語で記述
- **規約**: Conventional Commits の形式に従う
  - `feat: 新機能の追加`
  - `fix: バグ修正`
  - `docs: ドキュメント更新`
  - `refactor: リファクタリング`
  - `test: テスト追加・修正`
  - `chore: ビルド・補助ツール関連`

### Pull Request

- `/deploy` コマンドを使用してコミット・プッシュ・PR作成を一括実行
- PR タイトルは簡潔で内容を表すものにする
- PR 本文には変更内容のサマリーとテストプランを記載

## Supabase ガイドライン

### データベース

- **マイグレーション**: `supabase/migrations/` ディレクトリで管理
- **型安全**: Supabase CLI で型定義を生成（`supabase gen types typescript`）
- **RLS**: Row Level Security を適切に設定

### 認証

- **Supabase Auth**: Google ログイン認証を使用
- **セッション管理**: サーバーコンポーネントとクライアントコンポーネントで適切に処理
- **認証ガード**: 未認証ユーザーのアクセス制御を実装

### Storage

- **画像アップロード**: Supabase Storage を使用
- **パス構成**: `{userId}/{postId}/{filename}` の形式
- **パブリックアクセス**: 必要に応じて適切なバケットポリシーを設定

## Gemini API (File Search) ガイドライン

- **File Search API**: 画像のメタデータ抽出と検索機能に使用
- **エラーハンドリング**: API エラーを適切に処理
- **レート制限**: API のレート制限を考慮した実装

## セキュリティ

- **環境変数**: 機密情報は `.env.local` で管理（Git に含めない）
- **OWASP Top 10**: セキュリティ脆弱性（XSS, SQLインジェクション等）に注意
- **バリデーション**: ユーザー入力は必ずバリデーションを実施

## パフォーマンス最適化

- **画像最適化**: Next.js Image コンポーネントを使用
- **コード分割**: 動的インポートを活用
- **キャッシング**: 適切なキャッシュ戦略を実装

## テスト

- **ユニットテスト**: 重要なロジックにはテストを記述
- **E2Eテスト**: 主要なユーザーフローをカバー
- **CI/CD**: GitHub Actions でテストを自動実行

## カスタムコマンド

### /deploy

コミット、プッシュ、PR作成を一括実行するスラッシュコマンド。

```bash
/deploy [PR title (optional)]
```

## Claude Code 活用のベストプラクティス

### 具体的な指示

- 曖昧な指示ではなく、詳細で具体的な指示を提供する
- エッジケースを明示する
- 期待する動作を説明する

### ビジュアルコンテキストの提供

- スクリーンショットやモックアップを共有
- ペースト、ドラッグ&ドロップ、ファイルパス参照が可能

### ファイル参照

- タブ補完を使用して特定のファイルやフォルダを参照

### URL の含有

- 関連ドキュメントのリンクを貼る
- ドメインを許可リストに追加

### 早期の軌道修正

- コーディング前に計画を依頼
- Escape キーで中断・リダイレクト
- Escape ダブルタップで前のプロンプトを編集

### コンテキストのクリア

- 長いセッション中は `/clear` でコンテキストをクリア
- タスク間でコンテキストをリセット

### 複雑なタスクにはチェックリスト

- 大規模な移行や網羅的な解決策には Markdown チェックリストを使用
- 完了した項目をチェックオフしながら進行

## プロジェクト固有の注意事項

- **doc/** ディレクトリに設計ドキュメントが格納されている
- Issue テンプレートと GitHub Actions ワークフローが設定済み
- Husky フックでコミット前のチェックが実行される
- `/deploy` コマンドでデプロイワークフローを自動化

## 参考ドキュメント

- [doc/concept.md](doc/concept.md): コンセプト・技術方針
- [doc/features.md](doc/features.md): 機能仕様・画面設計
- [doc/technical-architecture.md](doc/technical-architecture.md): 技術アーキテクチャ・API設計

---

このガイドラインは定期的に見直し、プロジェクトの進化に合わせて更新してください。
